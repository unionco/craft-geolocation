var loadGoogleAPI=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];window.simpleMapsLoadingGoogle=!0;var a=document.createElement("script");a.type="text/javascript",a.src="https://www.google.com/jsapi?key="+e,a.onreadystatechange=function(){loadMapsApi(e,t,n)},a.onload=function(){loadMapsApi(e,t,n)},document.body.appendChild(a)},loadMapsApi=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];google.load("maps","3",{other_params:["libraries=places"+(n?",drawing":""),"key="+e,"language="+t.replace("_","-"),"region="+t].join("&"),callback:function(){document.dispatchEvent(new Event("SimpleMapsGAPILoaded"))}})},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),SimpleMapSettings=function(){function e(t,n,a,s){var o=this;classCallCheck(this,e),this.namespacedId=null,this.mapSettings={lat:51.272154,lng:.514951,zoom:15,height:400,boundary:{ne:{lat:0,lng:0},sw:{lat:0,lng:0}}},this.setup=!1,this.inputs=null,this.boundaries=null,this.settingsMap=null,this.settingsMapEl=null,this.settingsMapWrap=null,this.boundaryMap=null,this.boundaryButton=null,this.drawingManager=null,this.boundaryRectangle=null,this.mouseMoveLastPos=0,this.nextHeight=0,this.onHideMapToggle=function(e){var t=!!e.target.getElementsByTagName("input")[0].value;if(t){var n=o.settingsMapWrap.getBoundingClientRect().height+"px";0!==n&&(o.settingsMapWrap.style.maxHeight=n)}setTimeout(function(){o.settingsMapWrap.classList[t?"add":"remove"]("hide")},1)},this.onSettingsMapReposition=function(){o.inputs.lng.value=o.settingsMap.center.lng(),o.inputs.lat.value=o.settingsMap.center.lat()},this.onSettingsMapZoom=function(){o.inputs.zoom.value=o.settingsMap.getZoom()},this.onResizeMouseDown=function(e){e.preventDefault(),o.mouseMoveLastPos=e.clientY,o.nextHeight=o.mapSettings.height,o.settingsMapEl.style.pointerEvents="none",o.settingsMapWrap.style.maxHeight="",document.addEventListener("mousemove",o.onResizeMouseMove),document.addEventListener("mouseup",o.onResizeMouseUp)},this.onResizeMouseMove=function(e){o.nextHeight=o.nextHeight+(e.clientY-o.mouseMoveLastPos),o.mouseMoveLastPos=e.clientY,o.nextHeight<250||requestAnimationFrame(function(){o.mapSettings.height=o.nextHeight,o.inputs.height.value=o.nextHeight,o.settingsMapEl.style.height=o.nextHeight+"px";var e=o.settingsMap.getCenter();google.maps.event.trigger(o.settingsMap,"resize"),o.settingsMap.setCenter(e)})},this.onResizeMouseUp=function(){o.settingsMapEl.style.pointerEvents="",document.removeEventListener("mousemove",o.onResizeMouseMove),document.removeEventListener("mouseup",o.onResizeMouseUp)},this.onBoundaryButtonClick=function(){if(o.boundaries.neLat.value)return o.drawingManager.setOptions({drawingMode:null}),o.boundaryRectangle.setMap(null),o.boundaryRectangle=null,o.boundaries.neLat.value="",o.boundaries.neLng.value="",o.boundaries.swLat.value="",o.boundaries.swLng.value="",void(o.boundaryButton.textContent="Draw Boundaries");o.drawingManager.setOptions({drawingMode:google.maps.drawing.OverlayType.RECTANGLE}),o.drawingManager.setMap(o.boundaryMap),o.boundaryButton.textContent="Clear Boundaries"},this.onDrawingComplete=function(e){o.boundaryRectangle=e,o.hookBoundaryRectangleEvents(),o.storeNextBounds(e.getBounds()),o.drawingManager.setOptions({drawingMode:null})},this.onRectangleEdit=function(){o.storeNextBounds(o.boundaryRectangle.getBounds())},this.namespacedId=a,this.mapSettings=Object.keys(s).reduce(function(e,t){var n=s[t];return e[t]="boundary"===t?"string"==typeof n?JSON.parse(n):n:+n,e},{}),this.inputs={lat:document.getElementById(this.namespacedId+"lat"),lng:document.getElementById(this.namespacedId+"lng"),zoom:document.getElementById(this.namespacedId+"zoom"),height:document.getElementById(this.namespacedId+"height")},this.boundaries={neLat:document.getElementById(this.namespacedId+"boundaryRestrictionNELat"),neLng:document.getElementById(this.namespacedId+"boundaryRestrictionNELng"),swLat:document.getElementById(this.namespacedId+"boundaryRestrictionSWLat"),swLng:document.getElementById(this.namespacedId+"boundaryRestrictionSWLng")},this.boundaryButton=document.getElementById(this.namespacedId+"boundaryButton"),this.boundaryButton.addEventListener("click",this.onBoundaryButtonClick),"undefined"==typeof google?window.simpleMapsLoadingGoogle||loadGoogleAPI(t,n,!0):google.maps&&google.maps.places?this.setup||this.setupMaps():window.simpleMapsLoadingGoogle||loadMapsApi(t,n,!0),document.addEventListener("SimpleMapsGAPILoaded",function(){o.setup||o.setupMaps()}),document.getElementById("type").addEventListener("change",function(e){"ether\\simplemap\\fields\\MapField"===e.target.value&&o.redrawMaps()}),$("#"+this.namespacedId+"hideMap").on("change",this.onHideMapToggle)}return createClass(e,[{key:"setupMaps",value:function(){this.setup=!0,this.settingsMapEl=document.getElementById(this.namespacedId+"settingsMap"),this.settingsMapWrap=document.getElementById(this.namespacedId+"settingsMapWrap"),this.settingsMap=new google.maps.Map(this.settingsMapEl,{zoom:this.mapSettings.zoom,center:new google.maps.LatLng(this.mapSettings.lat,this.mapSettings.lng),scrollwheel:!1,fullscreenControl:!1,mapTypeControl:!1,streetViewControl:!1,rotateControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP}),google.maps.event.addListener(this.settingsMap,"dragend",this.onSettingsMapReposition),google.maps.event.addListener(this.settingsMap,"zoom_changed",this.onSettingsMapZoom),document.getElementById(this.namespacedId+"settingsMapHeight").addEventListener("mousedown",this.onResizeMouseDown);var e=document.getElementById(this.namespacedId+"boundaryMap");this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,rectangleOptions:{editable:!0}}),google.maps.event.addListener(this.drawingManager,"rectanglecomplete",this.onDrawingComplete),this.boundaryMap=new google.maps.Map(e,{zoom:this.mapSettings.zoom,center:new google.maps.LatLng(this.mapSettings.lat,this.mapSettings.lng),scrollwheel:!1,fullscreenControl:!1,mapTypeControl:!1,streetViewControl:!1,rotateControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP}),this.boundaries.neLat.value&&(this.boundaryRectangle=new google.maps.Rectangle({bounds:{north:+this.mapSettings.boundary.ne.lat,east:+this.mapSettings.boundary.ne.lng,south:+this.mapSettings.boundary.sw.lat,west:+this.mapSettings.boundary.sw.lng},map:this.boundaryMap,editable:!0}),this.boundaryMap.fitBounds(this.boundaryRectangle.getBounds()),this.hookBoundaryRectangleEvents())}},{key:"hookBoundaryRectangleEvents",value:function(){google.maps.event.addListener(this.boundaryRectangle,"bounds_changed",this.onRectangleEdit)}},{key:"storeNextBounds",value:function(e){var t=e.getNorthEast(),n=e.getSouthWest();this.boundaries.neLat.value=t.lat(),this.boundaries.neLng.value=t.lng(),this.boundaries.swLat.value=n.lat(),this.boundaries.swLng.value=n.lng()}},{key:"redrawMaps",value:function(){var e=this,t=this.settingsMap.getZoom(),n=this.settingsMap.getCenter(),a=this.boundaryMap.getZoom(),s=this.boundaryMap.getCenter();setTimeout(function(){google.maps.event.trigger(e.settingsMap,"resize"),e.settingsMap.setZoom(t),e.settingsMap.setCenter(n),google.maps.event.trigger(e.boundaryMap,"resize"),e.boundaryMap.setZoom(a),e.boundaryMap.setCenter(s)},1)}}]),e}();window.SimpleMapSettings=SimpleMapSettings;
//# sourceMappingURL=SimpleMapSettings.min.js.map
